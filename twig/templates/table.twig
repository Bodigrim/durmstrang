{% spaceless %}
{% include "header.twig" %}

<div class="container-fluid">


  <h2>
    Список заявок

    <div class="pull-right">
      <a href="/actions/logout.php" class="btn btn-danger">
        Выйти
      </a>
    </div>

  </h2>

  <table class="table table-striped sortable">
    <thead>
      <tr>
        <th>
          #
        </th>
        <th>
          ФИО
        </th>
        <th>
          Ник
        </th>
        <th>
          Город
        </th>
        <th>
          Группа поселения
        </th>
        <th>
          Взнос
        </th>
        <th>
          Питание
        </th>
        <th>
          Комната
        </th>
        <th>
          Статус
        </th>
      </tr>
    </thead>
    {% for user in users %}
      <tr id="{{ user.email }}">
        <td>
          <a href="/edit.php?email={{ user.email | url_encode }}">
            <i class="glyphicon glyphicon-edit"></i>
            {{ user.id }}
            {% if user.updated %}
              &nbsp; <span class="label label-danger" title="Изменения в заявке"><i class="glyphicon glyphicon-pencil"></i></span>
            {% endif %}
            {% if user.unread %}
              &nbsp; <span class="label label-danger" title="Новое сообщение"><i class="glyphicon glyphicon-envelope"></i></span>
            {% endif %}
          </a>
        </td>
        <td>
          {% if user.name %}
            {{ user.name }}
          {% else %}
            {{ user.email }}
          {% endif %}
        </td>
        <td>
          {{ user.nick }}
        </td>
        <td>
          {{ user.city }}
        </td>
        <td>
          {{ user.groupName }}
        </td>
        <td data-value="{{ user.payment }}" {% if not user.payment %} class="bg-danger" {% endif %}>
          <input type="checkbox" class="payment-checkbox" data-email="{{ user.email }}" {% if user.payment %} checked {% endif %}>
        </td>
        <td data-value="{{ user.payment_food }}" {% if not user.payment_food %} class="bg-danger" {% endif %}>
          <input type="checkbox" class="payment-food-checkbox" data-email="{{ user.email }}" {% if user.payment_food %} checked {% endif %}>
        </td>
        <td data-value="{{ user.payment_room }}" {% if not user.payment_room %} class="bg-danger" {% endif %}>
          <input type="checkbox" class="payment-room-checkbox" data-email="{{ user.email }}" {% if user.payment_room %} checked {% endif %}>
          {{ rooms[user.room] }}
        </td>
        <td data-value="{{ ordStatuses[user.status] }}">
          <select class="status-selector" data-email="{{ user.email }}">
            {% include "select.twig" with {all: statuses, selected: user.status} %}
          </select>
        </td>
      </tr>
    {% endfor %}
  </table>

  <div class="pull-right">
    <a href="/actions/backup.php" class="btn btn-default">
      Скачать бекап
    </a>
    &nbsp;
    <a href="/actions/export-csv.php" class="btn btn-default">
      Скачать CSV
    </a>
  </div>
</div>

{% include "footer.twig" with {additional_js : ["table.js"]} only %}
{% endspaceless %}
