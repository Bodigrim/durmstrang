{% spaceless %}
{% include "header.twig" %}

<div class="container-fluid">
  <div class="row">
    <div class="col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3">

  <h2>
    Заявка
    <a href="/edit.php?print=1&amp;email={{ email }}" class="badge">Версия для печати</a>

    <div class="pull-right">
    {% if isAdmin %}
      <a href="/" class="btn btn-primary">
        К таблице участников
      </a>
    {% else %}
      <a href="/table-public.php" class="btn btn-primary">
        К списку участников
      </a>
      &nbsp;
      <a href="/actions/logout.php" class="btn btn-danger">
        Выйти
      </a>
    {% endif %}
    </div>
  </h2>

  {% if photo %}
    <img src="/photos/{{ photo }}" class="photo-main img-responsive center-block" />
    <br />
  {% endif %}

  {% if justUpdated %}
    <div class="alert alert-success" role="alert">
      <b>Отлично!</b>
      Ваша заявка сохранена.
      Cпасибо, что вы зарегистрировались. На вашу почту ушло письмо с паролем и инструкциями.
      Будем рады вас видеть. Если письма нет, то проверьте папку «Спам».
    </div>
  {% endif %}

  <form action="/actions/update.php" method="post" id="edit" enctype="multipart/form-data">
    <input type="hidden" name="email" id="email" value="{{ email }}" />

    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation" class="active"><a href="#gamer" aria-controls="gamer" role="tab" data-toggle="tab">Игрок</a></li>
      <li role="presentation"><a href="#character" aria-controls="character" role="tab" data-toggle="tab">Персонаж</a></li>
      <li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Переписка</a></li>
    </ul>

    <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="gamer">

        {% if isAdmin %}
          <div class="form-group">
            <label for="name">E-mail</label>
            <input type="text" class="form-control" id="name" disabled value="{{ email }}" />
          </div>
        {% endif %}

        <div class="form-group">
          <label for="name">Имя</label>
          <input type="text" class="form-control" id="name" placeholder="Иван" name="name" value="{{ name }}" required />
        </div>

        <div class="form-group">
          <label for="surname">Фамилия</label>
          <input type="text" class="form-control" id="surname" placeholder="Иванов" name="surname" value="{{ surname }}" required />
        </div>

        <div class="form-group">
          <label for="nick">Ник или прозвище</label>
          <input type="text" class="form-control" id="nick" placeholder="Если нет — оставьте поле пустым" name="nick" value="{{ nick }}" />
        </div>

        <div class="form-group">
          <label for="age">Дата рождения</label>
          <input type="date" class="form-control" id="age" placeholder="1990-12-31" name="age" value="{{ age }}" pattern="\d\d\d\d-\d\d-\d\d" title="В формате ГГГГ-ММ-ДД" required />
        </div>

        <div class="form-group">
          <label for="contacts">Телефон</label>
          <input type="tel" class="form-control" id="contacts" placeholder="+38 (090) 898-79-78" name="contacts" value="{{ contacts }}" required />
        </div>

        <div class="form-group">
          <label for="facebook">Профиль в Facebook</label>
          <input type="url" class="form-control" id="facebook" placeholder="https://www.facebook.com/..." name="facebook" value="{{ facebook }}" />
        </div>

        <div class="form-group">
          <label for="telegram">Профиль в Telegram</label>
          <input type="text" class="form-control" id="telegram" placeholder="@Username" name="telegram" value="{{ telegram }}" pattern="@\w{5,}\s*" />
        </div>

        <div class="form-group">
          <label for="publicity">Как вас указать в сетке ролей?</label>
          {% include "radios.twig" with {all: publicities, selected: publicity, name: "publicity"} %}
        </div>

        <div class="form-group">
          <label for="contraindication">Медицинские противопоказания и хронические заболевания</label>
          <textarea class="form-control" rows="3" id="contraindication" name="contraindication" placeholder="Если отсутствуют — оставьте поле пустым">{{ contraindication }}</textarea>
        </div>

        <div class="form-group">
          <label for="photo">Добавить фото (JPEG, PNG или GIF). На фото должно быть хорошо видно ваше лицо. </label>
          <input type="file" id="photo" name="photo">
        </div>

        <div class="pull-right">
          <a class="btn btn-danger btn-xs" data-email="{{ email }}" id="delete-btn">Удалить заявку</a>
        </div>

      </div>
      <div role="tabpanel" class="tab-pane" id="character">

        <div class="form-group">
          <label for="character_name">Имя и фамилия</label>
          <input type="text" class="form-control" id="character_name" placeholder="Леголас" name="character_name" value="{{ character_name }}" />
        </div>

        <div class="form-group">
          <label for="block">Игровой блок (публичный)</label>
          <select class="form-control" name="block">
            {% include "select.twig" with {all: blocks, selected: block} %}
          </select>
        </div>

        <div class="form-group">
          <label for="character_age">Дата рождения</label>
          <input type="date" class="form-control" id="character_age" placeholder="1990-12-31" name="character_age" value="{{ character_age }}" pattern="\d\d\d\d-\d\d-\d\d" title="В формате ГГГГ-ММ-ДД" />
        </div>

        <div class="form-group">
          <label for="blood">Статус крови</label>
          {% include "radios.twig" with {all: bloods, selected: blood, name: "blood"} %}
        </div>

        <div class="form-group">
          <label for="quenta">Биография</label>
          <textarea class="form-control" rows="12" id="quenta" name="quenta" placeholder="Я шотландский дроу-ассасин, родился сиротой...">{{ quenta }}</textarea>
        </div>

        <div class="form-group">
          <label for="fear">Что вызывает у персонажа страх? Минимум три вещи</label>
          <textarea class="form-control" rows="4" id="fear" name="fear" placeholder="Кино, вино и домино">{{ fear }}</textarea>
        </div>

        <div class="form-group">
          <label for="possesions">Игровые предметы и существа (зелья, артефакты, магические животные и т. п.)</label>
          <textarea class="form-control" rows="4" id="possesions" name="possesions" placeholder="Если предпочтения отсутствуют, то оставьте поле пустым">{{ possesions }}</textarea>
        </div>

        <div class="form-group">
          <label for="charms">Чары, которые персонаж умеет кастовать</label>
          <textarea class="form-control" rows="4" id="charms" name="charms" placeholder="Если ничего не умеет, то оставьте поле пустым">{{ charms }}</textarea>
        </div>

        <div class="form-group">
          <label for="potions">Зелья, которые персонаж умеет варить</label>
          <textarea class="form-control" rows="4" id="potions" name="potions" placeholder="Если ничего не умеет, то оставьте поле пустым">{{ potions }}</textarea>
        </div>

        <div class="form-group">
          <label for="abilities">Специальные способности</label>
          <textarea class="form-control" rows="4" id="abilities" name="abilities" placeholder="Если ничего не умеет, то оставьте поле пустым">{{ abilities }}</textarea>
        </div>

        <div class="form-group">
          <label for="wish">Во что вы хотите поиграть?</label>
          <textarea class="form-control" rows="4" id="wish" name="wish" placeholder="Если предпочтения отсутствуют, то оставьте поле пустым">{{ wish }}</textarea>
        </div>

        <div class="form-group">
          <label for="antiwish">Во что вы категорически не хотите играть?</label>
          <textarea class="form-control" rows="4" id="antiwish" name="antiwish" placeholder="Если предпочтения отсутствуют, то оставьте поле пустым">{{ antiwish }}</textarea>
        </div>

        <div class="form-group">
          <label for="addendum">Дополнительные пожелания</label>
          <textarea class="form-control" rows="4" id="addendum" name="addendum" placeholder="Если отсутствуют — оставьте поле пустым">{{ addendum }}</textarea>
        </div>

      </div>
      <div role="tabpanel" class="tab-pane" id="messages">
        <br />
        <div id="messages">
          {% for message in messages %}
            <b>
              {{ message.name }}:
            </b>
            <br />
            {{ message.message | nl2br }}
            <hr />
          {% endfor %}
        </div>

        <textarea class="form-control" rows="3" id="message" placeholder="Ваше сообщение"></textarea>
        <button class="btn btn-default" id="send-message">Отправить</button>
        <br />
        <br />
        <br />

      </div>
    </div>

    <button type="submit" class="btn btn-primary btn-lg">Сохранить</button>
  </form>

    </div>
  </div>
</div>

{% include "footer.twig" with {additional_js : ["edit.js"]} only %}
{% endspaceless %}
